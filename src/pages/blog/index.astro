---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
let prev_year = 0;
let years: number[] = [];
let sorted_posts = posts.map((post) => {
  const year = new Date(post.data.pubDate).getFullYear();
  let isAnotherYear = year !== prev_year;
  if (isAnotherYear) {
    prev_year = year;
    years.push(year);
  }
  return {
    ...post,
    isAnotherYear,
  };
});
---

<Layout title="Archive">
  <div class="prose my-12 mx-auto">
    <ul>
      {
        sorted_posts.map((post) => (
          <>
            {post.isAnotherYear && <h3 class="bg-surface">{post.data.pubDate.getFullYear()}</h3>}
            <li>
              <a class="bg-surface" href={`/blog/${post.slug}/`}>{post.data.title}</a>
            </li>
          </>
        ))
      }
    </ul>
  </div>
</Layout>